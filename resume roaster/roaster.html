<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Roaster // TERMINAL</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <style>
        :root {
            --primary: #d946ef; /* Fuchsia 500 */
            --secondary: #8b5cf6; /* Violet 500 */
            --bg-dark: #0f172a;
        }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(at 0% 0%, rgba(217, 70, 239, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(139, 92, 246, 0.15) 0px, transparent 50%);
            font-family: 'JetBrains Mono', monospace;
            color: #e2e8f0;
            min-height: 100vh;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .neon-text {
            text-shadow: 0 0 10px rgba(217, 70, 239, 0.7), 0 0 20px rgba(217, 70, 239, 0.5);
            font-family: 'Orbitron', sans-serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        /* Loader Animation */
        .scanner-line {
            height: 2px;
            width: 100%;
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
            animation: scan 2s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateY(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(400%); opacity: 0; }
        }
        
        /* Markdown Styles */
        .prose h1, .prose h2, .prose h3 { color: #f0abfc; margin-top: 1em; margin-bottom: 0.5em; font-weight: bold; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .prose strong { color: #e879f9; }
        .prose p { margin-bottom: 1em; line-height: 1.6; }
    </style>
</head>
<body class="p-4 md:p-8 flex flex-col items-center">

    <header class="text-center mb-8 relative z-10">
        <h1 class="text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-400 to-violet-400 neon-text mb-2">
            RESUME ROASTER
        </h1>
        <p class="text-slate-400 text-sm tracking-widest uppercase">Local LLM Inference // <span id="status-dot" class="text-green-400">‚óè</span> System Online</p>
    </header>

    <main class="w-full max-w-4xl space-y-6">
        
        <div class="glass-panel rounded-xl p-6 grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="flex flex-col gap-2">
                <label class="text-xs text-fuchsia-300 font-bold uppercase">Personality Module</label>
                <select id="mode" class="bg-slate-900 border border-slate-700 text-white rounded-lg p-3 focus:outline-none focus:border-fuchsia-500 transition">
                    <option value="savage">üî• Savage (Default)</option>
                    <option value="mild">üíñ Wholesome/Constructive</option>
                    <option value="recruiter">üëî Jaded Recruiter</option>
                    <option value="pirate">üè¥‚Äç‚ò†Ô∏è Pirate Captain</option>
                    <option value="genz">üíÄ Gen Z Brainrot</option>
                    <option value="boomer">üë¥ Angry Boomer</option>
                    <option value="elon">üöÄ Elon Mode</option>
                </select>
            </div>

            <div class="flex flex-col gap-2">
                <label class="text-xs text-violet-300 font-bold uppercase">Ollama Model Tag</label>
                <input type="text" id="model-tag" value="llama3.2:3b-instruct-q4_k_m" class="bg-slate-900 border border-slate-700 text-white rounded-lg p-3 focus:outline-none focus:border-violet-500 transition" placeholder="e.g. llama3, mistral">
            </div>

            <div class="flex flex-col gap-2">
                <label class="text-xs text-blue-300 font-bold uppercase">Creativity (Temp): <span id="temp-val">0.8</span></label>
                <input type="range" id="temp" min="0.1" max="1.5" step="0.1" value="0.8" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-fuchsia-500 mt-3">
            </div>
        </div>

        <div id="drop-zone" class="glass-panel rounded-xl p-10 border-2 border-dashed border-slate-600 hover:border-fuchsia-500 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center group relative overflow-hidden">
            <input type="file" id="fileInput" accept=".pdf" class="hidden">
            
            <div class="z-10 text-center">
                <i class="fa-solid fa-cloud-arrow-up text-5xl text-slate-500 group-hover:text-fuchsia-400 mb-4 transition"></i>
                <h3 class="text-xl font-bold text-white group-hover:text-fuchsia-300">Drop Resume PDF Here</h3>
                <p class="text-slate-400 text-sm mt-2">or click to browse local files</p>
                <p class="text-xs text-slate-600 mt-4 font-mono">100% Local Privacy. Data never leaves localhost.</p>
            </div>
            
            <div class="absolute inset-0 bg-fuchsia-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
        </div>

        <div id="loader" class="hidden text-center py-8">
            <div class="w-full max-w-md mx-auto relative h-1 bg-slate-800 overflow-hidden rounded mb-4">
                <div class="absolute top-0 left-0 h-full w-1/3 bg-gradient-to-r from-transparent via-fuchsia-500 to-transparent animate-[scan_1.5s_infinite_linear]"></div>
            </div>
            <p id="loading-text" class="text-fuchsia-400 animate-pulse font-mono">Initializing roast sequence...</p>
        </div>

        <div id="result-container" class="hidden">
            <div class="glass-panel rounded-xl overflow-hidden relative">
                <div class="bg-slate-900/80 p-3 flex justify-between items-center border-b border-slate-700">
                    <span class="text-xs font-mono text-slate-400">OUTPUT.MD</span>
                    <div class="flex gap-2">
                        <button onclick="speakText()" class="p-2 hover:bg-slate-700 rounded text-slate-300 hover:text-white" title="Read Aloud"><i class="fa-solid fa-volume-high"></i></button>
                        <button onclick="copyText()" class="p-2 hover:bg-slate-700 rounded text-slate-300 hover:text-white" title="Copy Markdown"><i class="fa-regular fa-copy"></i></button>
                        <button onclick="downloadImage()" class="p-2 hover:bg-slate-700 rounded text-slate-300 hover:text-white" title="Save Image"><i class="fa-solid fa-camera"></i></button>
                    </div>
                </div>
                
                <div id="output-content" class="prose prose-invert max-w-none p-8 font-sans"></div>
                
                <div class="bg-slate-900/50 p-2 text-center text-xs text-slate-500 border-t border-slate-700 font-mono">
                    ROAST COUNT: <span id="counter" class="text-fuchsia-500">0</span> | GENERATED BY LOCAL OLLAMA
                </div>
            </div>
            <button onclick="resetUI()" class="mt-4 w-full py-3 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 transition font-bold border border-slate-700">Roast Another</button>
        </div>

    </main>

    <script type="module">
        import * as pdfjsLib from 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.min.mjs';
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.worker.min.mjs';
        window.pdfjsLib = pdfjsLib;
    </script>

    <script>
        // --- Configuration & State ---
        let roastCount = parseInt(localStorage.getItem('roastCount') || '0');
        document.getElementById('counter').textContent = roastCount;
        let currentMarkdown = "";

        const modes = {
            savage: 'You are a ruthless professional resume roaster. Do not hold back. Mock generic skills, clich√©s, poor formatting, and weak phrasing. Use emojis. End with a score out of 10. Be brutal.',
            mild: 'You are a constructive but funny career coach. Poke fun at mistakes lightly but offer genuinely good advice. End with a score out of 10. Be encouraging.',
            recruiter: 'You are a jaded tech recruiter who has seen 100,000 resumes. Speak in corporate buzzwords. Complain about "rockstars" and "ninjas". Be cynical.',
            pirate: 'Ye be a pirate captain! Roast this parchment using heavy pirate slang. Mock their "landlubber" skills. Arr!',
            genz: 'You are Gen Z. Use heavy slang (no cap, fr, on god, skull emoji). Roast their "boomer" layout and "mid" skills. Be chaotic.',
            boomer: 'You are a 70-year-old manager. You hate AI, remote work, and modern job titles. Complain that they should just walk in and shake the CEO\'s hand.',
            elon: 'You are Elon Musk. Tweet-style roast. Short, punchy, slightly unhinged. Mention Mars, efficiency, and hardcore engineering.'
        };

        const loadingMessages = [
            "Judging your life choices...",
            "Analyzing font choice (it's bad)...",
            "Laughing at 'Proficient in Microsoft Word'...",
            "Consulting the roasted archives...",
            "Detecting lies in the Skills section...",
            "Cringing at the summary...",
            "Calculating employability percentage..."
        ];

        // --- DOM Elements ---
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('fileInput');
        const loader = document.getElementById('loader');
        const resultContainer = document.getElementById('result-container');
        const outputContent = document.getElementById('output-content');
        const tempSlider = document.getElementById('temp');
        const tempVal = document.getElementById('temp-val');
        const loadingText = document.getElementById('loading-text');

        // --- Event Listeners ---
        tempSlider.addEventListener('input', (e) => tempVal.textContent = e.target.value);
        
        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-fuchsia-500', 'bg-slate-800');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-fuchsia-500', 'bg-slate-800');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-fuchsia-500', 'bg-slate-800');
            if (e.dataTransfer.files[0]) processFile(e.dataTransfer.files[0]);
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) processFile(e.target.files[0]);
        });

        // --- Core Logic ---

        function resetUI() {
            resultContainer.classList.add('hidden');
            dropZone.classList.remove('hidden');
            fileInput.value = '';
            currentMarkdown = "";
        }

        async function processFile(file) {
            if (!file.name.toLowerCase().endsWith('.pdf')) {
                alert('‚ö†Ô∏è PDF files only, please!');
                return;
            }

            // UI Transition
            dropZone.classList.add('hidden');
            loader.classList.remove('hidden');
            
            // Text Extraction
            let text = "";
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await window.pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                // Update loading text
                const msgInterval = setInterval(() => {
                    loadingText.textContent = loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
                }, 2000);

                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(item => item.str).join(' ') + '\n';
                }

                if (!text.trim()) throw new Error("No text found. Is this an image PDF?");

                // API Call
                const modeKey = document.getElementById('mode').value;
                const modelTag = document.getElementById('model-tag').value.trim() || 'llama3.2';
                const temperature = parseFloat(document.getElementById('temp').value);

                const response = await fetch('http://localhost:11434/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: modelTag,
                        messages: [
                            { role: 'system', content: modes[modeKey] + " Format your response in clean Markdown." },
                            { role: 'user', content: `Here is the resume content. Roast it within 300 words:\n\n${text.substring(0, 10000)}` }
                        ],
                        stream: false,
                        temperature: temperature
                    })
                });

                clearInterval(msgInterval);

                if (!response.ok) throw new Error("Ollama connection failed. Is it running?");

                const data = await response.json();
                currentMarkdown = data.message.content;
                
                // Render & Show
                displayResult(currentMarkdown);
                updateCounter();

            } catch (err) {
                console.error(err);
                loader.classList.add('hidden');
                dropZone.classList.remove('hidden');
                alert(`Error: ${err.message}\nMake sure 'ollama serve' is running.`);
            }
        }

        function displayResult(markdown) {
            loader.classList.add('hidden');
            resultContainer.classList.remove('hidden');
            
            // Parse Markdown to HTML
            outputContent.innerHTML = marked.parse(markdown);
            
            // Scroll to result
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function updateCounter() {
            roastCount++;
            localStorage.setItem('roastCount', roastCount);
            document.getElementById('counter').textContent = roastCount;
        }

        // --- Action Buttons ---

        function copyText() {
            navigator.clipboard.writeText(currentMarkdown);
            const btn = document.querySelector('button[onclick="copyText()"]');
            const originalIcon = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-check text-green-400"></i>';
            setTimeout(() => btn.innerHTML = originalIcon, 2000);
        }

        function speakText() {
            if ('speechSynthesis' in window) {
                // Strip markdown symbols for cleaner speech
                const cleanText = currentMarkdown.replace(/[#*`_]/g, '');
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.rate = 1.1;
                utterance.pitch = 0.9;
                window.speechSynthesis.speak(utterance);
            } else {
                alert("Browser doesn't support TTS.");
            }
        }

        function downloadImage() {
            const element = document.getElementById('result-container');
            // Hide buttons for screenshot
            const toolbar = element.querySelector('.bg-slate-900\\/80'); // Escape / for querySelector
            toolbar.style.opacity = '0';
            
            html2canvas(element, {
                backgroundColor: '#0f172a',
                scale: 2
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'resume-roast.png';
                link.href = canvas.toDataURL();
                link.click();
                toolbar.style.opacity = '1';
            }).catch(err => {
                alert("Screenshot failed");
                toolbar.style.opacity = '1';
            });
        }
    </script>
</body>
</html>
